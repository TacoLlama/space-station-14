using Content.Client.UserInterface.Controls;
using Content.Shared._Starlight.Antags.TerrorSpider;
using Content.Shared.Popups;
using Content.Shared.RCD;
using Content.Shared.RCD.Components;
using Robust.Client.AutoGenerated;
using Robust.Client.GameObjects;
using Robust.Client.Graphics;
using Robust.Client.Player;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;
using Robust.Shared.Prototypes;
using System.Numerics;

namespace Content.Client._Starlight.Antags.TerrorSpider;

[GenerateTypedNameReferences]
public sealed partial class EggsLayingMenu : RadialMenu
{
    [Dependency] private readonly EntityManager _entManager = default!;

    private SpriteSystem? _sprites;
    public event Action<EntProtoId>? EggChosen;

    public EggsLayingMenu()
    {
        IoCManager.InjectDependencies(this);
        RobustXamlLoader.Load(this);
        _sprites = _entManager.System<SpriteSystem>();
        Refresh();
        Open();
    }
    public void Refresh()
    {
        var main = FindControl<RadialContainer>("Main");

        AddButton(main, "Red", _sprites!.GetPrototypeIcon("MobTerrorRed").TextureFor(Direction.South), "TerrorRedEggSpiderFertilized");
        AddButton(main, "Green", _sprites.GetPrototypeIcon("MobTerrorGreen").TextureFor(Direction.South), "TerrorGreenSpiderFertilized");
        AddButton(main, "Gray", _sprites.GetPrototypeIcon("MobTerrorGray").TextureFor(Direction.South), "TerrorGrayEggSpiderFertilized");
    }

    private void AddButton(RadialContainer main, string tooltip, Texture sprite, string prototype)
    {
        var button = new MenuButton()
        {
            StyleClasses = { "RadialMenuButton" },
            SetSize = new Vector2(64f, 64f),
            ToolTip = tooltip,
        };

        var tex = new TextureRect()
        {
            VerticalAlignment = VAlignment.Center,
            HorizontalAlignment = HAlignment.Center,
            Texture = sprite,
            TextureScale = new Vector2(2f, 2f),
        };
        button.OnButtonUp += _ => EggChosen?.Invoke(prototype);
        button.AddChild(tex);
        main.AddChild(button);
    }
}

public sealed class MenuButton : RadialMenuButton
{
    public MenuButton()
    {
    }
}
