using Content.Shared.IdentityManagement;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.XAML;

namespace Content.Client._Starlight.Character.UI;

[GenerateTypedNameReferences]
public sealed partial class CharacterViewControl : Control
{
    [Dependency] private readonly IEntityManager _entMan = default!;

    public Direction? SpriteDirection
    {
        get => CharacterSpriteView.OverrideDirection;
        set => CharacterSpriteView.OverrideDirection = value;
    }

    public CharacterViewControl()
    {
        RobustXamlLoader.Load(this);
        IoCManager.InjectDependencies(this);
    }

    public void SetCharacter(EntityUid? target, string? subText = null, EntityUid? viewer = null)
    {
        CharacterSpriteView.SetEntity(target);
        if (!target.HasValue)
        {
            ClearCharacter();
            return;
        }

        CharacterNameLabel.Text = Identity.Name(target.Value, _entMan, viewer);
        if (subText != null)
            CharacterSubText.Text = subText;
    }

    public void ClearCharacter()
    {
        CharacterSpriteView.SetEntity(null);
        CharacterNameLabel.Text = string.Empty;
        CharacterSubText.Text = string.Empty;
    }
}